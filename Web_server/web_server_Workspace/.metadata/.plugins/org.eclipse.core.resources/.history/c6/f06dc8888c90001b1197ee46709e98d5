package member.controller;

import java.io.IOException;
import java.sql.Date;
import java.util.Calendar;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import member.model.service.MemberService;
import member.model.vo.Member;

/**
 * Servlet implementation class MemberUpdateServlet
 */
@WebServlet("/member/memberUpdate")
public class MemberUpdateServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;	
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
			request.setCharacterEncoding("utf-8");
			
			String memberId =request.getParameter("memberId");
			String password =request.getParameter("password");
			String memberName =request.getParameter("memberName");
			String  gender =request.getParameter("gender");
			String birthday =request.getParameter("birthday");
			String email =request.getParameter("email");
			String phone =request.getParameter("phone");
			String address =request.getParameter("address");
			String[] hobbies = request.getParameterValues("hobby");
			String hobby = "";
			Date enrollDate =new Date(Calendar.getInstance().getTimeInMillis());
			
			if(hobbies != null) hobby = String.join(",", hobbies);
			//String 메서드를 입력받은 문자열 값을  Date로 변경 
						Date birthday_ = null;
						if(birthday != null && !"".equals(birthday))
							birthday_ = Date.valueOf(birthday);
		Member member= new  Member(memberId,password,memberName, MemberService.MEMBER_ROLE,gender,birthday_,email,phone,address,hobby,enrollDate);
		
		System.out.println("member@Servlet"+member) ;
		
		int result =new MemberService().updateMember(member);
		HttpSession session = request.getSession(true);
		if(result >0) {
			System.out.println("회원정보수정!");
			session.setAttribute("msg","회원정보수정이 완료되었습니다.!");
		}else {
			System.out.println("회원가입 실패!");
			session.setAttribute("msg","회원정보수정 이 실패하였습니다.");
		}
	}

}
